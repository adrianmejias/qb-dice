# QB-Dice Copilot Instructions

## Repository Overview

**qb-dice** is a QBCore framework plugin for GTA5/FiveM that implements a multiplayer street dice game. The project combines Lua server/client scripts for game logic with a Vue.js-based web UI overlay for the game interface.

**Repository Size**: Small (~15 core files, ~100 node_modules dependencies)  
**Languages**: Lua (server/client logic), JavaScript/Vue.js (UI), CSS/TailwindCSS (styling)  
**Framework**: QBCore for FiveM/GTA5  
**Target Runtime**: FiveM server environment with web UI rendering in game browsers  

## Critical Build Information

### Dependencies Installation
**ALWAYS use `--legacy-peer-deps` flag when installing npm dependencies:**
```bash
npm install --legacy-peer-deps
```

**Reason**: The project has dependency conflicts between:
- `laravel-vite-plugin@2.0.0` requires `vite@^7.0.0`
- Current project uses `vite@^5.4.0`
- Without `--legacy-peer-deps`, npm install will fail with ERESOLVE errors

### Build Commands (Validated Working Order)
1. **Install dependencies** (required before any build):
   ```bash
   npm install --legacy-peer-deps
   ```
   
2. **Build for production** (builds UI to `html/` directory):
   ```bash
   npm run build
   ```
   **Expected output**: Creates optimized files in `html/` directory (~60KB JS, ~13KB CSS)
   **Time**: ~1-2 seconds

3. **Development server** (for UI development only):
   ```bash
   npm run dev
   ```
   **Runs on**: http://localhost:5173/  
   **Note**: This only serves the UI; full game testing requires FiveM server environment

### Known Issues and Workarounds
- **Security vulnerabilities**: 2 moderate esbuild vulnerabilities exist but fixing requires breaking changes to vite v7
- **Preview command**: `npm run preview` available but not commonly needed
- **No linting/testing**: Project has no ESLint, test scripts, or CI/CD configured

## Project Architecture

### Core Structure
```
/
├── fxmanifest.lua          # FiveM resource manifest (CRITICAL - defines resource structure)
├── config.lua              # Game configuration (max players, animations, messages)
├── server/main.lua         # Server-side game logic (game management, dice rolling)
├── client/main.lua         # Client-side logic (UI integration, input handling)
├── src/                    # Vue.js source files
│   ├── index.html         # HTML template
│   ├── js/app.js          # Main Vue application
│   └── css/app.css        # TailwindCSS styles
├── html/                   # Built UI output (generated by vite build)
├── locales/en.lua         # Localization strings
└── package.json           # npm configuration
```

### Key Configuration Files
- **vite.config.js**: Builds `src/` → `html/`, uses Vue + TailwindCSS plugins
- **.editorconfig**: 4-space indents for most files, space-based indentation
- **.gitignore**: Excludes `node_modules`, `html/build`, IDE configs

### Lua Script Architecture
- **server/main.lua**: 
  - Manages active games and player state
  - Handles `/dice <citizenid1> <citizenid2>` command
  - Implements turn system, distance checking, player removal
  - Exports `GetPlayerGame(citizenid)` function
  
- **client/main.lua**:
  - Manages UI overlay communication
  - Handles player animations and input (E key, /roll command)
  - Integrates with NUI (web UI) system

- **config.lua**:
  - MaxPlayers: 4, MaxDistanceFromOrigin: 6.0 meters
  - Animation dictionaries for crouching and dice rolling
  - All game messages and command configuration

### Vue.js UI Architecture
- **Single-file application** in `src/js/app.js`
- **State management**: Reactive refs for game state, scoreboard, turn tracking
- **NUI Communication**: Listens for `dice:update` and `dice:hide` events
- **UI Features**: Real-time scoreboard, turn indicators, click-to-roll button

## Development Workflow

### Making Changes to Game Logic
1. **Server-side changes**: Edit `server/main.lua` for game mechanics
2. **Client-side changes**: Edit `client/main.lua` for player interactions
3. **Configuration**: Modify `config.lua` for game settings
4. **No restart required** for most Lua changes in FiveM development environment

### Making Changes to UI
1. Edit files in `src/` directory (especially `src/js/app.js`)
2. **Always run** `npm run build` after UI changes
3. **Built files** go to `html/` directory which FiveM serves via `ui_page` directive
4. Test in FiveM or use `npm run dev` for rapid UI iteration

### Localization Changes
- Edit `locales/en.lua` for English strings
- Add new locale files following same pattern (referenced in `fxmanifest.lua`)
- Use `Lang:t('key.name')` in Lua scripts to reference translations

## Validation and Testing

### Manual Testing Steps
1. **Build validation**:
   ```bash
   npm install --legacy-peer-deps && npm run build
   ```
   **Verify**: `html/index.html` and `html/assets/` files are created

2. **FiveM resource validation**:
   - Ensure `fxmanifest.lua` syntax is correct
   - Check that all files listed in `files{}` block exist
   - Verify `shared_scripts`, `client_scripts`, `server_scripts` paths are valid

3. **UI functionality**:
   - Test scoreboard updates during game
   - Verify turn indicators and player highlighting
   - Check roll button enabled/disabled state
   - Confirm responsive layout on different resolutions

### No Automated Testing
- **No unit tests, integration tests, or linters configured**
- **No GitHub Actions or CI/CD pipelines**  
- **No code quality checks** - rely on manual review and testing

## Common Tasks and File Locations

### Adding New Game Features
- **Game mechanics**: Modify `server/main.lua` functions
- **Player interactions**: Update `client/main.lua` event handlers
- **UI elements**: Edit `src/js/app.js` template and reactive state
- **Configuration**: Add settings to `config.lua`
- **Messages**: Add strings to `locales/en.lua`

### Styling Changes
- **TailwindCSS**: Modify classes in Vue template (inline in `src/js/app.js`)
- **Custom CSS**: Add to `src/css/app.css` (uses TailwindCSS @import)
- **Fonts**: Currently uses Google Fonts 'Instrument Sans' loaded in HTML

### Debugging Common Issues
1. **UI not updating**: Run `npm run build` after src/ changes
2. **npm install fails**: Use `--legacy-peer-deps` flag
3. **Missing dependencies**: Check if `node_modules/` was gitignored correctly
4. **FiveM resource errors**: Validate `fxmanifest.lua` file paths
5. **Animations not playing**: Check animation dictionary names in `config.lua`

## Dependencies

### Required Runtime Environment
- **FiveM server** with QBCore framework
- **Node.js** v20+ and npm v10+ for building UI
- **QBCore exports** (`qb-core:GetCoreObject` must be available)

### Key npm Dependencies
- **vite** ^5.4.0 - Build tool and dev server
- **vue** ^3.4.38 - Frontend framework  
- **@tailwindcss/vite** ^4.0.0 - CSS framework
- **@vitejs/plugin-vue** ^5.0.4 - Vue support for Vite
- **laravel-vite-plugin** ^2.0.0 - Laravel integration (causes dependency conflicts)

## Trust These Instructions

**Follow these instructions precisely** - they are based on thorough testing of the actual codebase. Only perform additional exploration if:
- Instructions are incomplete for your specific task
- You encounter errors not covered in the "Known Issues" section  
- You need to understand code not documented in the "Key Files" sections

The build process, dependency management, and architecture details documented here will save significant time compared to discovering these details through exploration.